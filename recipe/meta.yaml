{% set name = "tiledbsoma" %}
{% set version = "1.1.1" %}
{% set sha256 = "28b37b0c896a08c0b6261d7deb2940300735a492ac82fa71f7b3de543b57b1c2" %}



package:
  name: {{ name }}
  version: {{ version }}

source:
  #url: https://github.com/single-cell-data/TileDB-SOMA/archive/{{ version }}.tar.gz
  url: https://github.com/single-cell-data/TileDB-SOMA/archive/089fb868ebd633b2808b9d39c5024287d69a650d.tar.gz
  sha256: {{ sha256 }}

build:
  number: 2
  skip: true  # [win or linux32 or py2k]

outputs:
  - name: libtiledbsoma
    version: {{ version }}
    script: build-libtiledbsoma.sh  # [not win]
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ compiler('cxx') }}
        - git
        - cmake
        - make  # [not win]
      host:
        - tiledb 2.15.*
        - spdlog
        - fmt
      run:
        - tiledb 2.15.*
        - spdlog
        - fmt
  - name: tiledbsoma-py
    version: {{ version }}
    script: build-tiledbsoma-py.sh
    build:
      # binary_relocation: 
      #   - lib/python*/site-packages/tiledbsoma/libtiledbsoma.*
      #   - lib/python*/site-packages/tiledbsoma/pytiledbsoma.*.so
    requirements:
      build:
        - {{ compiler('cxx') }}
        - {{ compiler('c') }}
        - python                                 # [build_platform != target_platform]
        - cross-python_{{ target_platform }}     # [build_platform != target_platform]
        # - pybind11                               # [build_platform != target_platform]
        # - pyarrow 9.0.*                          # [build_platform != target_platform]
        # - numba                                  # [build_platform != target_platform]
        # - scipy                                  # [build_platform != target_platform]
        # - numpy                                  # [build_platform != target_platform]
      host:
        - python
        # - numba
        # - numpy
        - libtiledbsoma {{ version }}
        - pyarrow 9.0.*
        - pybind11
        - setuptools
        - setuptools_scm
        - wheel
        # - pip
        # - scipy
      run:
        - {{ pin_compatible('numpy', lower_bound='1.16', upper_bound='1.24') }}
        - {{ pin_subpackage('libtiledbsoma', exact=True) }}
        - anndata
        - pandas
        - pyarrow 9.0.*
        - scanpy 1.9.*
        - scipy
        - anndata
        - tiledb-py 0.21.*
        - typing-extensions
        - numba
        - attrs
        - numpy
        # - somacore 1.0.*
    imports:
      - tiledbsoma
    test:
      commands:
        - python -c "import tiledbsoma; print(tiledbsoma.pytiledbsoma.version())"

about:
  home: http://tiledb.com
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: 'TileDB-SOMA API'
  description: 'Python API for efficient storage and retrieval of single-cell data using TileDB'
  doc_url: https://docs.tiledb.com/
  dev_url: https://github.com/single-cell-data/TileDB-SOMA

extra:
  recipe-maintainers:
    - johnkerl
    - gspowley
    - shelnutt2
    - mlin
